<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>File: lsgmake-gap.rb</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



  <div id="fileHeader">
    <h1>lsgmake-gap.rb</h1>
    <table class="header-table">
    <tr class="top-aligned-row">
      <td><strong>Path:</strong></td>
      <td>lsgmake-gap.rb
      </td>
    </tr>
    <tr class="top-aligned-row">
      <td><strong>Last Update:</strong></td>
      <td>Mon Mar 23 16:07:19 -0500 2009</td>
    </tr>
    </table>
  </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <h1>NAME</h1>
<p>
lsgmake-gap - runs the Illumina GAPipeline in parallel on an LSF cluster.
</p>
<h1>SYNOPSIS</h1>
<p>
lsgmake-gap [OPTIONS]&#8230; [TARGET]
</p>
<h1>DESCRIPTION</h1>
<p>
The parallelization is based on the <a
href="https://gscweb.gsc.wustl.edu/gscdoc/solexa/pipeline/Pipeline%20parallelisation.html">Genome
Analyzer Pipeline documentation</a> and uses LSF to run jobs and manage
dependencies between jobs. This script should be run after you have run
goat_pipeline.py, creating the Data directory and necessary Firecrest and
Bustard Makefiles. If you have also already run GERALD.pl (either using the
&#8212;GERALD option to goat_pipeline.py or directly), you must be sure to
include the following line in your GERALD configuration file if you are
using the ELAND aligner.
</p>
<pre>
  ELAND_MULTIPLE_INSTANCES 8
</pre>
<p>
If this script is run with no arguments, it will try to figure out what
kind of directory it is in and make all the targets for that directory.
</p>
<p>
If you have specified automatic calibration in the GERALD configuration
file, this script will pick that up and alter the jobs submitted and their
dependencies accordingly. Note that you will need to use provide the
&#8212;with-qval option to goat_pipeline.py for auto-calibration to work.
</p>
<p>
The targets and dependencies in Bustard changed in GAPipeline1.3. This
automatically detects that and adjusts the targets/dependencies
accordingly.
</p>
<p>
Each target is submitted as a separate job to LSF and generates a separate
stdout/stderr file with a name like <tt>make-TARGET-JOBID.out</tt>.
</p>
<h1>OPTIONS</h1>
<p>
If an argument to a long option is mandatory, it is also mandatory for the
corresponding short option; the same is true for optional arguments.
</p>
<table>
<tr><td valign="top"><tt>&#8212;bsub-options</tt> <em>BSUBOPTIONS</em>:</td><td>Pass along <em>BSUBOPTIONS</em> to all bsub commands.

</td></tr>
<tr><td valign="top"><tt>&#8212;dependency</tt> <em>LSFJOBID</em>:</td><td>Make the first set of jobs submitted have a dependency on <em>LSFJOBID</em>
(see &#8212;status to set type of dependency).

</td></tr>
<tr><td valign="top"><tt>&#8212;help</tt>:</td><td>Output this information.

</td></tr>
<tr><td valign="top"><tt>&#8212;id</tt> <em>ID</em>:</td><td>Specify unique identifier, <em>ID</em>, to incorporate into job name.

</td></tr>
<tr><td valign="top"><tt>&#8212;jobs</tt> N:</td><td>Run N jobs on a single node. N should be equal to the number of slots on
each node. The default N is 1. Each target is sent to a single node using
the <tt>span[hosts=1]</tt> resource specification to the bsub command.

</td></tr>
<tr><td valign="top"><tt>&#8212;lanes</tt> K,L,M,N:</td><td>If there are bad lanes in a run and you do not want them analyzed, you can
have the script only submit jobs for specific lane targets rather than all
the lanes, 1 through 8. Use this command-line option and only list the
lanes you want analyzed. Note that you will still have to run
goat_pipeline.py and have a GERALD configuration file that selects specific
lanes for analysis.

</td></tr>
<tr><td valign="top"><tt>&#8212;path</tt> <em>PATH</em>:</td><td>Run make in directory <em>PATH</em> rather than current directory.

</td></tr>
<tr><td valign="top"><tt>&#8212;queue</tt> <em>QUEUE</em>:</td><td>Submit all jobs to LSF queue <em>QUEUE</em> rather than the default.

</td></tr>
<tr><td valign="top"><tt>&#8212;resource</tt> <em>RESOURCE</em>:</td><td>In addition to the <tt>span[hosts=1]</tt> resource specification added to
each bsub command, also specify the resource RESOURCE.

</td></tr>
<tr><td valign="top"><tt>&#8212;status</tt> <em>STATUS</em>:</td><td>Use job status dependency of STATUS rather than done (finish normally with
a zero exit value).

</td></tr>
<tr><td valign="top"><tt>&#8212;test</tt>:</td><td>Just print out what commands would be run, do not actually submit any jobs.

</td></tr>
<tr><td valign="top"><tt>&#8212;version</tt>:</td><td>Output command name and version.

</td></tr>
</table>
<h1>EXAMPLES</h1>
<p>
To run Firecrest, Bustard, and GERALD for the run in
</p>
<pre>
  /gscmnt/sata100/techd/RUN_NAME/Data/CN-M_FirecrestVERSION-DATE
</pre>
<p>
You can either do this
</p>
<pre>
  $ cd /gscmnt/sata100/techd/RUN_NAME/Data/CN-M_FirecrestVERSION-DATE
  $ lsgmake-gap recursive
</pre>
<p>
or this
</p>
<pre>
  $ lsgmake-gap --path=/gscmnt/sata100/techd/RUN_NAME/Data/CN-M_FirecrestVERSION-DATE recursive
</pre>
<p>
If no GERALD directory exists, it will exit gracefully after completing
Bustard. You can still run GERALD separately as you always have.
</p>
<pre>
  $ cd .../GERALD
  $ lsgmake-gap
</pre>
<p>
or
</p>
<pre>
  $ lsgmake-gap --path=.../GERALD
</pre>
<p>
If a specific part of the pipeline fails, e.g., the s_7 target in the
Bustard directory, you should kill the pending LSF jobs, change to the
Bustard directory, and run
</p>
<pre>
  $ lsgmake-gap recursive
</pre>
<p>
While all the jobs names will be the same, LSF is not smart enough to
figure that out and pick up that the original job failed and another with
the same name was subsequently submitted and completed successfully.
</p>
<p>
To only analyze lanes 3 and 4, create a GERALD configuration file, named,
for example, +gerald34.config+ that has a line like this
</p>
<pre>
  125678:ANALYSIS none
</pre>
<p>
and then run goat_pipeline.py like this
</p>
<pre>
  $ goat_pipeline.py --make --tiles=s_3,s_4 --GERALD=gerald34.config .
</pre>
<p>
Finally, run this script in the Firecrest directory like this
</p>
<pre>
  $ lsgmake-gap --lanes 3,4 recursive
</pre>
<p>
If you want to schedule jobs before the run is completed, you can use the
<tt>-b</tt> option to bsub when running your goat_pipeline.py command
(since you will not want to run goat_pipeline.py until the run completes).
If you determine the run will complete on 15 June at 2:30 p.m., then you
can run the following command to submit the goat_pipeline.py job
</p>
<pre>
  $ bsub -q short -b 6:15:14:30 -J DIR.goat -o goat.out goat_pipeline.py --make --GERALD=gerald.config Run/DIR
</pre>
<p>
then use the <tt>-w</tt> option to bsub so lsgmake-gap will not run until
the goat jobs completes (the Firecrest directory must exist when
lsgmake-gap runs)
</p>
<pre>
  $ bsub -q short -w DIR.goat -o lsgmake-gap.out lsgmake-gap --path Run/DIR
</pre>
<p>
If you run GERALD.pl after you have already run lsgmake-gap on the
Firecrest and Bustard directories, you can submit the GERALD jobs before
the Bustard jobs complete using the <tt>&#8212;dependency</tt> option. If
the job name of the last Bustard job is
s070613_SLXA-EAS8_0000_5751.Bustard1.8.28_15-06-2007_mhickenb.all, you
would run
</p>
<pre>
  $ lsgmake-gap --dependency s070613_SLXA-EAS8_0000_5751.Bustard1.8.28_15-06-2007_mhickenb.all --path Firecrest/Bustard/GERALD
</pre>
<h1>SEE ALSO</h1>
<p>
bsub(1), <a
href="https://gscweb.gsc.wustl.edu/gscdoc/solexa/pipeline">gscweb.gsc.wustl.edu/gscdoc/solexa/pipeline</a>/
</p>
<h1>AUTHOR</h1>
<p>
David Dooling &lt;<a
href="mailto:ddooling@wustl.edu">ddooling@wustl.edu</a>&gt;
</p>
<h1>COPYRIGHT</h1>
<p>
Copyright (C) 2009 Washington University in St. Louis
</p>
<p>
This program is free software: you can redistribute it and/or modify it
under the terms of the GNU General Public License as published by the Free
Software Foundation, either version 3 of the License, or (at your option)
any later version.
</p>

    </div>

    <div id="requires-list">
      <h3 class="section-bar">Required files</h3>

      <div class="name-list">
      optparse&nbsp;&nbsp;
      rdoc/usage&nbsp;&nbsp;
      </div>
    </div>

   </div>


  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>